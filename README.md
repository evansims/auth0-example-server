# Auth0 Demonstration Client

Thanks for your interest in my demonstration server of [Auth0's](https://auth0.com/) robust authentication and management APIs. This is one half of a project demonstrating how one might go about implimenting Auth0's APIs to interact with a custom frontend.

This repo houses the PHP-based backend server. [The accompanying JavaScript-based backend server can be found here.](https://github.com/evansims/auth0-example-client)

This example project uses the [Lumen microframework](https://lumen.laravel.com/) but you could use any framework at all to build a server like this, simply adapt the techniques used here appropriately.

## Overview of the Demonstration API

This project demonstrates the following functions:

- Validating access tokens, in this case from the [frontend client](https://github.com/evansims/auth0-example-client)
- Fetch Auth0's JWKS keys from the API
- Verifying token signatures using JWKS keys
- Authenticating API requests from Auth0's Authentication API before issuing Management API calls
- Demonstrate simple Management API calls â€” specifically, the /users endpoint, listing and searching users.

### Authenticating

This demonstration API expects a `token` paramter containing an Auth0 Authentication API JWT for all requests. If one is not provided, or an invalid token is sent, calls will be rejected. These tokens are generated by the [frontend](https://github.com/evansims/auth0-example-client) after signing in automatically.

[You can learn more about generating access tokens here.](https://auth0.com/docs/tokens/access-tokens)

Manually issuing an API call with an access token might look like this:

```
curl \
  --request GET \
  --url 'http://localhost:8000/users?token=YOUR_ACCESS_TOKEN'
```

### Listing and Searching for Users

This demonstration API pulls a list of users from Auth0 via the `/users` endpoint, and supports searching and pagination.

To simply return a paginated list of users:

```
curl \
  --request GET \
  --url 'http://localhost:8000/users?token=YOUR_ACCESS_TOKEN'
```

To paginate for more users, note that pages begin at 0.

```
curl \
  --request GET \
  --url 'http://localhost:8000/users?token=YOUR_ACCESS_TOKEN&page=PAGE_NUMBER'
```

To search for users:

```
curl \
  --request GET \
  --url 'http://localhost:8000/users?token=YOUR_ACCESS_TOKEN&q=SEARCH_TERM'
```

## Requirements

- [Docker](https://www.docker.com/)
- The paired [example client](https://github.com/evansims/auth0-example-client)

## Getting Started

First, clone this repository to your local machine.

```
git clone https://github.com/evansims/auth0-example-server.git
```

### 1. Setup the Auth0 Machine-to-Machine Application

1. [Sign up for an Auth0 account](https://manage.auth0.com/dashboard), if you don't already have one, and sign in.
2. From your [Auth0 dashboard](https://manage.auth0.com/dashboard/) select 'Applications' from the sidebar.
3. Press the 'Create Application' button and choose 'Machine to Machine Application.'
4. Make note of the `Client ID`, `Client Secret` and `Domain` values shown, you'll need these later.

### 2. Setup an Auth0 API

1. From your [Auth0 dashboard](https://manage.auth0.com/dashboard/) select 'APIs' from the sidebar.
2. For efficiency sake we'll select the existing 'Auth0 Management API', but you can use your own if you prefer. Select your API.
3. Under the _Settings_ tab, make note of the unique `Identifier` value, you'll need this.
4. Under the _Machine to Machine Applications_ tab, authorize the Application you created in the previous steps.
5. Click the > arrow next to your application name to display permissions/scopes available to your application. The only permission required for this example is 'read:users' but you can "select all" if you prefer.
6. Press 'update' to apply the permissions to your Application.

### 3. Create demo users

1. From your [Auth0 dashboard](https://manage.auth0.com/dashboard/) expand 'Users & Roles' in the sidebar.
2. Select Users.
3. Create a series of example users for the demonstration. One of these users will be used by you to authenticate, so set an email address and password you'll remember.

### 4. Configure your Auth0 credentials

1. Duplicate `.env.default` and name it `.env`
2. Set the value of `AUTH0_CLIENTID` to the Client ID of your M2M Application, setup in the previous steps.
3. Set `AUTH0_SECRET` to the Client Secret of your M2M Application.
4. Set `AUTH0_DOMAIN` to the Domain of your M2M Application.
5. Set `AUTHO_AUDIENCE` to the Identifier of your API, setup in the previous steps.
6. Save the configuration file.

Note that some of these values are sensitive, and should be treated like a password. Never commit these to public repositories.

### 5. Launch the backend

This project makes use of [Docker](https://www.docker.com/) to simplify getting started and reduce the complexity of installing dependencies.

```
$ docker-compose up -d
```

This will launch the server and begin listening for connections. You will also need to install all the dependencies the project requires, which can be done by issuing this command:

```
$ docker-compose exec app composer update
```

You can now access the API at [http://localhost:8000](http://localhost:8000) on your local machine.

When you're ready to shut down the server, simply use:

```
$ docker-compose down
```

## Auth0 Documentation

- Documentation for Auth0's APIs can be found [here](https://auth0.com/docs/api/info).
- Quickstarts for a variety of use cases, languages and respective frameworkss can be found [here](https://auth0.com/docs/quickstarts).

## Contributing

Pull requests are welcome!

## Security Vulnerabilities

If you discover a security vulnerability within this project, please send an e-mail to Evan Sims at hello@evansims.com. All security vulnerabilities will be promptly addressed.

## License

The Lumen framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
